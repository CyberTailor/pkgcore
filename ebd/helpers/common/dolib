#!/usr/bin/env pkgcore-ebuild-helper
# Copyright: 2011 Brian Harring <ferringb@gmail.com>
# License: GPL2/BSD 3 clause

check_args 1 -

LIBDIR=${ED}${DESTTREE}/$(__get_libdir lib)

if [[ ${HELPER_NAME} == "dolib.so" ]]; then
	LIBOPTIONS="-m0755"
elif [[ ${HELPER_NAME} == "dolib.a" ]]; then
	LIBOPTIONS="-m0644"
fi

libs() {
	for x in "$@"; do
		if [[ -L ${x} ]]; then
			# yes we want readlink, not readlink -f; we want the symlink content,
			# not the resolved symlink target.
			check_command ln -s -- "$(readlink -- "${x}")" "${LIBDIR}/${x##*/}" >/dev/null
		else
			echo "${x}"
		fi
	done
}

libs "$@" | ${XARGS} install ${LIBOPTIONS} -D -t "${LIBDIR}" --
check_pipe
